<!DOCTYPE html>
<html lang="vi" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>Log Sentinel Dashboard</title>
    <meta http-equiv="refresh" content="1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { background-color: #212529; }
        .card { background-color: #2b3035; }
        .table { background-color: #2b3035; }
        .type-ml { color: #f8d7da; /* Red */ }
        .type-ssh { color: #ffc107; /* Yellow */ }
        .type-web { color: #0dcaf0; /* Cyan */ }
        .confidence-high { background-color: rgba(220, 53, 69, 0.15); }
        pre { background-color: #343a40; color: #f8f9fa; padding: 10px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4 text-light"><i class="fa-solid fa-shield-virus"></i> Log Sentinel Dashboard</h1>
        <p class="text-muted">Tự động cập nhật sau 1 giây...</p>
        
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="card text-light shadow-sm">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <i class="fa-solid fa-triangle-exclamation fa-3x text-danger me-4"></i>
                            <div>
                                <h5 class="card-title text-danger">TỔNG CẢNH BÁO</h5>
                                <h2 class="card-text display-4">{{ total_alerts }}</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card text-light shadow-sm">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <i class="fa-solid fa-bug fa-3x text-warning me-4"></i>
                            <div>
                                <h5 class="card-title text-warning">LOẠI PHỔ BIẾN NHẤT</h5>
                                <h2 class="card-text">{{ top_attack_type }}</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <h2 class="text-light">Cảnh báo mới nhất</h2>
        <div class="table-responsive shadow-sm">
            <table class="table table-dark table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th><i class="fa-regular fa-clock"></i> Thời gian</th>
                        <th><i class="fa-solid fa-flag"></i> Loại Cảnh Báo</th>
                        <th><i class="fa-solid fa-laptop-code"></i> IP Nguồn</th>
                        <th><i class="fa-solid fa-circle-info"></i> Chi tiết</th>
                        <th><i class="fa-solid fa-check-double"></i> Độ tự tin</th>
                        <th><i class="fa-solid fa-file-alt"></i> Log Gốc</th>
                    </tr>
                </thead>
                <tbody>
                    {% for alert in alerts %}
                        <tr class="{% if alert['confidence'] > 0.9 %}confidence-high{% endif %}">
                            
                            <td>{{ alert['timestamp'] }}</td>
                            
                            <td class="
                                {% if 'ML' in alert['alert_type'] %}type-ml{% endif %}
                                {% if 'SSH' in alert['alert_type'] %}type-ssh{% endif %}
                                {% if 'Web' in alert['alert_type'] %}type-web{% endif %}
                            ">
                                <strong>{{ alert['alert_type'] }}</strong>
                            </td>
                            
                            <td>{{ alert['ip_address'] }}</td>

                            <td style="max-width: 300px; word-break: break-all;">
                                {{ alert['details'] }}
                            </td>
                            
                            <td>
                                {% if alert['alert_type'] == 'ML Attack' %}
                                <div class="progress" style="height: 20px;">
                                    <div class="progress-bar bg-danger" role="progressbar" 
                                         style="width: {{ alert['confidence'] * 100 }}%;" >
                                         {{ "%.1f"|format(alert['confidence'] * 100) }}%
                                    </div>
                                </div>
                                {% else %}
                                    <span class="text-muted">N/A</span>
                                {% endif %}
                            </td>
                            
                            <td>
                                <details>
                                    <summary>Xem JSON</summary>
                                    <pre>{{ alert['raw_log_data'] | tojson(indent=2) }}</pre>
                                </details>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="6" class="text-center">Chưa có cảnh báo nào.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>